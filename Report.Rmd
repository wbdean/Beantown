---
title: "An Analysis of Boston Neighborhoods"
author: "William Dean"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(tidytext)
library(dplyr)
library(ggmap)
library(topicmodels)
source("Figures.R")
set.seed(201)
```

# Overview

## Motivation

I really enjoy to travel especially visiting new cities around the world. I currently live in Boston, MA and have become very familiar with the area.

In a few of my most recent travels, I have found difficulty exploring bigger cities. When spending a few days in a certain city, I often end up spending a lot of time traveling within the city, not having enough time to connect with the people and the cultures.

## Goal

The *goal of this project* is to use data from areas and neighborhoods of cities to see how communities compare to others within the same city and also to others in different. 

When looking each neighborhood, there a few things that I am interested in measuring:

- What are the people like? How are the people that live in the area and what do people who visit think of the area and their time there.

- What are the living situations like? What kind of houses are in the area.

- What is the culture like? What are these communities known for and what are people talking about?

## Data

I wanted data that would reflect all these measure. Here are a few sources I found.

### Airbnb

The [Airbnb Datasets](http://insideairbnb.com/get-the-data.html) provides insight into many cities in the US and around the world. Not only are there reviews written by people who use the service, but also the listings have information about the neighborhood, the house, and the host.

Using this information will provide information for the people who live in the neighborhood, details of the neighborhoods from the hosts, and the experiences of the people who visit.

### Twitter

Twitter data gives insight to what is going on within a neighborhood, and what people are talking about. This accomplished trying to capture the neighborhood culture and potentially what people are like.

### Selected Data

I ended looking at the Boston data mainly and also using data from Chicago. There were a few limitations with the Airbnb data from chicago where only the house listing was provided. With it, there was no information about the host, or the reviews themselves from the people who stayed there. 


### Methods

Doing the analysis, I mainly used a bag of words approach to the text analysis. For a neighborhood's set of reviews, I collected all the defining words for a given neighborhood as well as important sets of two words for a neighborhood.

When comparing two or more neighborhoods to each other, I used latent Dirichlet allocation (LDA) to group into a set of $k$ topics. 

# Boston

## People from each Neighborhood

### Hosts

Each Airbnb Host provides a description of themself and their household. Using the methods stated above, I grouped terms from each neighborhood. This process appeared to catch terms associated with people and aspects of their lives. Consider the words choosen for Brighton, MA below:

```{r, echo = FALSE, message = FALSE, warning=FALSE, fig.align='center', fig.height=4, fig.width=4}
load("BHost.tfidf.Rda")
load("BHost.2.Rda")
knitr::kable(BHost.tfidf$bigram %>% 
                 filter(neighbourhood == "Brighton") %>% 
                 select(bigram) %>% head(5), col.names = "Brighton Neighborhood Bigrams")
```

The third row in context of it's host description is: "Lorin works as an *accountant downtown* and takes the expressway bus which is a quick 20 minute ride."

Doing this for all of the neighborhoods, and grouping all 25 Boston neighborhoods into 15, we see the following result: 


```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}

BHost.lda <- BHost.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 10, control = list(seed = 2)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
ggplot(left_join(BHost.lda,boston.map, by = c("document" = "Name"))) + 
    geom_polygon(aes(Long, Lat, fill = factor(topic), group = document), color = "black") + theme_nothing()
```

Regions of the same color (same grouping) appear either next to each other or are in similar proximity to downtown. This seems likely with people living outside of downtown and commuting into the city.


### People's Reviews

Considering all the reviews of the Airbnbs for the neighborhoods of Boston and which area's reviews are most similar, we see the results below:

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}
load("BReview.2.Rda")
BReview.lda <- BHost.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 10, control = list(seed = 2)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
ggplot(left_join(BReview.lda,boston.map, by = c("document" = "Name"))) + 
    geom_polygon(aes(Long, Lat, fill = factor(topic), group = document), color = "black") + theme_nothing()
```

The contents of what people are saying into their reviews seems to depend on what neighborhood they are staying. Again, many neighborhoods far from the heart of Boston look to be grouped together, and as the neighborhoods get closer, there appear to stay grouped together. Southie and East Boston group together, the Fenway area, and JP Neighborhoods.

## Boston Neighborhoods

### Neighborhood Descriptions

Every Airbnb host provides a description of the neighborhood where their property. From the results, we see that many of the adjacent neighborhoods in Boston are grouped together. For example, Downtown and Seaport are grouped together, but Southie is grouped by itself.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}
load("BNeigh.2.Rda")
BNeigh.lda <- BNeigh.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 10, control = list(seed = 1)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
ggplot(left_join(BNeigh.lda,boston.map, by = c("document" = "Name"))) + 
    geom_polygon(aes(Long, Lat, fill = factor(topic), group = document), color = "black") + theme_nothing()
```

### Housing

Using each Airbnb listing's detailed description of the property, we gain information about the type of homes in each location. 

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}
load("BHouse.2.Rda")
BHouse.lda <- BHouse.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 10, control = list(seed = 5)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
ggplot(left_join(BHouse.lda,boston.map, by = c("document" = "Name"))) + 
    geom_polygon(aes(Long, Lat, fill = factor(topic), group = document), color = "black") + theme_nothing(tit)
```

### Culture

Looking at tweets associated with each neighborhood either through direct mention or in a hashtag, we can pick up on what people in each area are talking about. The tweets were sample during the week of November, 30th. Here are the clusters:

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}
load("BTweets.2.Rda")
BTweets.lda <- BTweets.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 10, control = list(seed = 2)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
ggplot(left_join(BTweets.lda,boston.map, by = c("document" = "Name"))) + 
    geom_polygon(aes(Long, Lat, fill = factor(topic), group = document), color = "black") + theme_nothing(tit)
```



# Comparison of Boston and Chicago

After looking at Boston, let's consider how another city's neighborhoods compare to the ones we just explored.

There are some limitations as stated before with the data from Chicago. We will only compare the tweets from both cities and the names of the Airbnb lisings. 

## Tweets

This data will help understand which neighborhoods in Boston are talking about similiar topics as the neighborhoods in Chicago. Using LDA with 25 topics for all 25 Boston neighborhoods, we can check if any of of the Boston neighborhoods match with neighborhoods in Chicago, or if the neighborhoods in Boston are completely different than Chicago.

Below are the areas in Chicago that are similar to Downtown Boston based of the twitter data. The projected similar locations in Chicago are in fact close to the downtown area of Chicago as well.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align='center', fig.height=4, fig.width=4}
load("Tweets.2.Rda")
bostonneighborhoods <- boston.map$Name %>% 
    as.factor() %>%
    levels()
Tweets.lda <- Tweets.2 %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 25, control = list(seed = 6)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
Tweets.lda <- Tweets.lda %>% 
    mutate(city = ifelse(document %in% bostonneighborhoods, 
                         "Boston", "Chicago"))
knitr::kable(Tweets.lda %>% 
                 filter(topic == 2) %>% 
                 select(city, document) %>% 
                 arrange(city), 
             col.names = c("City", "Neighborhood"))

ggplot(chicago.map, 
       aes(Long, Lat, fill = Name_ID %in% c(96, 58, 5), 
           group = Name)) +
    geom_polygon(color = "black") + theme_nothing()
    
```



## Description of Houses

The Airbnb information for Chicago is quite limited however, comparing the listing names for the properties in Boston and Chicago give the following results.

```{r, echo = FALSE, message = FALSE, warning = FALSE}
load("Home.Rda")
Home.lda <- Home %>% 
    cast_dtm(neighbourhood, text, n) %>% 
    LDA(k = 25, control = list(seed = 5)) %>% 
    tidy(matrix = "gamma") %>% 
    group_by(document) %>% 
    top_n(1, gamma)
Home.lda <- Home.lda %>% 
    mutate(city = ifelse(document %in% bostonneighborhoods, 
                         "Boston", "Chicago"))
Home.tbl <- Home.lda %>%
    group_by(topic) %>% 
    summarise(n = sum(city == "Boston") / n())
names(Home.tbl) <- c("Grouping", "% Boston Neighborhood")
Home.tbl <- bind_cols(Home.tbl[1:12, ], 
                      Home.tbl[-c(1:12), ])
knitr::kable(Home.tbl)
```

Using property listing names to represent the type of homes in an area may be a stretch, but it does group neighborhoods in Boston with neighborhoods in Chicago.

# Conclusion

The neighborhoods in Boston have a interesting relationship with each other and are similiar in as many ways as they are different. 

## Next Steps 

Even though I was able to shed light behind the questions I had starting this project, I think this is just one approach to the question. Continuing on, I would like to see what other data I could use to expand on this and maybe separate each neighborhood into further classifications. 

## What I Learned

With this project, this was the first time where I used only text data to answer questions. I got very familiar with the packages in R for text mining, mainly `tidytext`, `tm`, and `topicmodels`.  







